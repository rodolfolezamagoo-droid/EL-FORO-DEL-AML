<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El mundo de BETO - Foro</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f4f4f4; }
        #foro { background: #fff; padding: 20px; max-width: 600px; margin: 40px auto; border-radius: 8px; display: none; }
        #mensajesRecientes, #mensajesTodos { margin-top: 20px; }
        .mensaje { border-bottom: 1px solid #ddd; padding: 10px 0; }
        .mensaje:last-child { border-bottom: none; }
        textarea { width: 100%; height: 60px; }
        button { margin-top: 10px; margin-right: 10px; }
        h2 { margin-bottom: 5px; }
        #etiquetaForm { background: #fff; padding: 20px; max-width: 400px; margin: 60px auto; border-radius: 8px; box-shadow: 0 2px 8px #0001; }
        #etiquetaActual { font-weight: bold; color: #2a7; }
        #cambiarEtiquetaBtn { margin-left: 10px; font-size: 0.9em; }
    </style>
</head>
<body>
    <form id="etiquetaForm" onsubmit="setEtiqueta(event)" style="display:none;">
        <label for="inputEtiqueta">Tu etiqueta: </label>
        <input type="text" id="inputEtiqueta" placeholder="Ej: BETO123" maxlength="20" required>
        <button type="submit">Entrar al foro</button>
    </form>

    <div id="foro">
        <h1>Foro libre de BETO</h1>
        <p>¡Habla de lo que quieras! (Los mensajes se guardan en tu navegador)</p>
        <div id="etiquetaActual"></div>
        <button id="cambiarEtiquetaBtn" onclick="mostrarFormularioEtiqueta()">Cambiar etiqueta</button>
        <textarea id="inputMensaje" placeholder="Escribe tu mensaje aquí..."></textarea>
        <br>
        <button onclick="publicarMensaje()">Publicar</button>
        <button onclick="agregarMensaje()">Agregar mensaje</button>

        <div id="mensajesRecientes">
            <h2>Mensajes recientes</h2>
            <div id="recientes"></div>
        </div>

        <div id="mensajesTodos">
            <h2>Todos los mensajes</h2>
            <div id="todos"></div>
        </div>
    </div>
    <script>
        let etiqueta = localStorage.getItem('etiquetaForo') || '';
        // Cargar mensajes guardados o iniciar vacío
        let mensajes = [];
        if (localStorage.getItem('mensajesForo')) {
            try {
                mensajes = JSON.parse(localStorage.getItem('mensajesForo'));
            } catch (e) {
                mensajes = [];
            }
        }

        function guardarMensajes() {
            localStorage.setItem('mensajesForo', JSON.stringify(mensajes));
        }

        function setEtiqueta(event) {
            event.preventDefault();
            const input = document.getElementById('inputEtiqueta');
            etiqueta = input.value.trim();
            if (etiqueta.length === 0) return;
            localStorage.setItem('etiquetaForo', etiqueta);
            document.getElementById('etiquetaForm').style.display = 'none';
            document.getElementById('foro').style.display = 'block';
            mostrarEtiquetaActual();
        }

        function mostrarEtiquetaActual() {
            const span = document.getElementById('etiquetaActual');
            if (etiqueta) {
                span.textContent = `Etiqueta actual: ${etiqueta}`;
            } else {
                span.textContent = '';
            }
        }

        function mostrarFormularioEtiqueta() {
            document.getElementById('foro').style.display = 'none';
            document.getElementById('etiquetaForm').style.display = 'block';
            document.getElementById('inputEtiqueta').value = etiqueta;
            document.getElementById('inputEtiqueta').focus();
        }

        function publicarMensaje() {
            if (!etiqueta) {
                alert("Debes elegir una etiqueta antes de publicar.");
                return;
            }
            const input = document.getElementById('inputMensaje');
            const texto = input.value.trim();
            if (texto.length === 0) return;
            mensajes.unshift({ texto, etiqueta });
            guardarMensajes();
            mostrarMensajes();
            input.value = '';
        }

        function agregarMensaje() {
            if (!etiqueta) {
                alert("Debes elegir una etiqueta antes de publicar.");
                return;
            }
            const texto = prompt("Escribe tu mensaje:");
            if (texto && texto.trim().length > 0) {
                mensajes.unshift({ texto: texto.trim(), etiqueta });
                guardarMensajes();
                mostrarMensajes();
            }
        }

        function mostrarMensajes() {
            // Mensajes recientes (máximo 5)
            const recientesDiv = document.getElementById('recientes');
            recientesDiv.innerHTML = '';
            mensajes.slice(0, 5).forEach(msg => {
                const div = document.createElement('div');
                div.className = 'mensaje';
                div.innerHTML = `<span style="color:#2a7;">[${msg.etiqueta}]</span> ${msg.texto}`;
                recientesDiv.appendChild(div);
            });

            // Todos los mensajes
            const todosDiv = document.getElementById('todos');
            todosDiv.innerHTML = '';
            mensajes.forEach(msg => {
                const div = document.createElement('div');
                div.className = 'mensaje';
                div.innerHTML = `<span style="color:#2a7;">[${msg.etiqueta}]</span> ${msg.texto}`;
                todosDiv.appendChild(div);
            });
        }

        // Si ya hay una etiqueta guardada, entra directo al foro
        window.onload = function() {
            if (etiqueta) {
                document.getElementById('etiquetaForm').style.display = 'none';
                document.getElementById('foro').style.display = 'block';
                mostrarEtiquetaActual();
            } else {
                document.getElementById('etiquetaForm').style.display = 'block';
                document.getElementById('foro').style.display = 'none';
            }
            mostrarMensajes();
        };
    </script>
</body>
</html>